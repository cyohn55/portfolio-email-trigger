name: Portfolio Email Trigger

on:
  schedule:
    # Every 3 minutes - reliable external trigger
    - cron: '*/3 * * * *'
  workflow_dispatch: # Allow manual triggering

jobs:
  trigger-portfolio:
    runs-on: ubuntu-latest
    
    steps:
    - name: Trigger Portfolio Email Processing
      run: |
        echo "ğŸš€ Triggering portfolio email processing..."
        echo "â° Trigger time: $(date)"
        echo "ğŸ¯ Target: cyohn55/Portfolio workflow"
        
        response=$(curl -s -w "%{http_code}" -X POST \
          -H "Accept: application/vnd.github.v3+json" \
          -H "Authorization: token ${{ secrets.PORTFOLIO_TRIGGER_TOKEN }}" \
          https://api.github.com/repos/cyohn55/Portfolio/actions/workflows/email-to-portfolio.yml/dispatches \
          -d '{"ref":"main"}')
        
        if [[ "$response" == *"204"* ]]; then
          echo "âœ… Successfully triggered portfolio workflow"
          echo "ğŸ“§ Portfolio email processing should start within 30 seconds"
          echo "ğŸŒ Check status: https://github.com/cyohn55/Portfolio/actions"
        else
          echo "âŒ Failed to trigger workflow. HTTP Code: ${response: -3}"
          echo "ğŸ” Response: $response"
          exit 1
        fi
        
        echo ""
        echo "ğŸ‰ Trigger completed successfully!"
        echo "â° Next automatic trigger in 3 minutes"
